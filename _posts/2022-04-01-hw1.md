---
layout: post
title: Homework 1
---
### 1.Create a Database

Import data 


```python
import pandas as pd
import sqlite3
```

To determine whether the object has the right type of data


```python
temps = pd.read_csv("temps_stacked.csv")
temps.head()
```



### Write a Geographic Scatter Function for Yearly Temperature Increases

Linear regression is to predict a dependent variable value y based on a given independent variable x. We can use linear regression to find the linear relationship between year and temperature.


```python
from sklearn.linear_model import LinearRegression
def coef(data_group):
    """
    This function is to find the slope of the line and that 
    corresponds to "average change in temp per year".
    """
    X = data_group[["Year"]]
    y = data_group["Temp"]
    LR = LinearRegression()
    LR.fit(X, y)
    slope = LR.coef_[0]
    return slope
```


```python
from plotly import express as px
import numpy as np
def temperature_coefficient_plot(country, year_begin, year_end, month, min_obs, **kwargs):
    df=query_climate_database(country, year_begin, year_end, month)
    df = df[df.groupby(["NAME"])["Year"].transform(len) >= min_obs]
    df_1 = df.groupby(["NAME"])["LATITUDE"].aggregate(np.mean)
    df_2 = df.groupby(["NAME"])["LONGITUDE"].aggregate(np.mean)
    coefs = df.groupby(["NAME"]).apply(coef)
    df_3 = pd.DataFrame(coefs)
    df_4 = pd.concat([df_1,df_2,df_3], axis = 1)
    df_4.rename(columns = {0: "Estimated Yearly Increase (°C)"}, inplace = True)
    month_dict = {1:"January", 2:"February", 3:"March", 4:"April", 5:" May", 6:"June", 7:"July", 8:"August", 9:"September", 10:"October", 11:"November", 12:"December"}
    fig = px.scatter_mapbox(df_4, # data for the points you want to plot
                        lat = "LATITUDE", # column name for latitude informataion
                        lon = "LONGITUDE", # column name for longitude information
                        hover_name = "Estimated Yearly Increase (°C)", # what's the bold text that appears when you hover over
                        color = "Estimated Yearly Increase (°C)",
                        **kwargs)
    fig.update_layout(title = f"Estimates of yearly increase in temperature in {month_dict[1]} <br> for stations in {country}, years {year_begin} - {year_end}")
    return fig
```


```python
color_map = px.colors.diverging.RdGy_r # choose a colormap
fig = temperature_coefficient_plot("India", 1980, 2020, 1, 
                                   min_obs = 10,
                                   zoom = 2,
                                   mapbox_style="carto-positron",
                                   color_continuous_scale=color_map,
                                   )
fig.show()
```
<div class = "display">
{% include g1.html %}
</div>


### 4.Create Two More Interesting Figures

#### (1)The Plot Question: How does the temperature of each city in a country monthly change?


```python
def f(country, year):
    conn = sqlite3.connect("temps.db")
    cmd = \
    """
    SELECT S.name, C.name , T.year,  T.temp, T.month
    FROM temperatures T
    LEFT JOIN stations S ON T.id = S.id
    LEFT JOIN countries C ON SUBSTRING(S.id,1,2) = C."fips_10-4"
    WHERE C.name = ? AND T.year = ? 
    """
    df = pd.read_sql_query(cmd, conn, params=(country, year))
    df = df.rename(columns= {"Name": "Country"})
    conn.close()
    fig = px.scatter(data_frame = df, # data that needs to be plotted
                 x = "Month", # column name for x-axis
                 y = "Temp", # column name for y-axis
                 color = "NAME", # column name for color coding
                 title = f"In {year},the temperature for each city in {country} "
                )
    return fig
fig = f(country = "Italy", year = 2020)
fig.show()
```
<div class = "display">
{% include g2.html %}
</div>



#### (2) The plot question: How has temperature changed between  two countries on a time period?


```python
def g(country_1, country_2, year_begin, year_end):
    conn = sqlite3.connect("temps.db")
    cmd = \
    """
    SELECT S.name, C.name , T.year,  T.temp, T.month
    FROM temperatures T
    LEFT JOIN stations S ON T.id = S.id
    LEFT JOIN countries C ON SUBSTRING(S.id,1,2) = C."fips_10-4"
    WHERE C.name = ? AND (T.year BETWEEN ? AND ?)
    """
    df_1 = pd.read_sql_query(cmd, conn, params=(country_1, year_begin, year_end))
    df_2 = pd.read_sql_query(cmd, conn, params=(country_2, year_begin, year_end))
    df = pd.concat([df_1,df_2], axis = 0)
    df = df.rename(columns= {"Name": "Country"})
    conn.close()
    df = df.groupby(["Year","Country"]).aggregate(np.mean)
    df = df.reset_index()
    fig = px.density_heatmap(df, 
                         x = "Year", 
                         y = "Temp",
                         facet_row = "Country",
                         nbinsx = 25,
                         nbinsy = 25)
    return fig
fig = g(country_1 = "Italy", country_2 = "Japan",year_begin = 1980, year_end = 2020)
fig.show()
```

<div class = "display">
{% include g3.html %}
</div>

From these two graph, we can see that the temperature is increasing as the time goes on. Although countries are different, the temperature is increasing in different countries. Therefore, we can conclude that the earth is warming.